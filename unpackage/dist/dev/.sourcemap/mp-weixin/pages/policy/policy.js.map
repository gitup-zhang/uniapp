{"version":3,"file":"policy.js","sources":["pages/policy/policy.vue","D:/Hbuild/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcG9saWN5L3BvbGljeS52dWU"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <!-- 顶部固定导航栏 -->\n    <uni-nav-bar statusBar=\"true\" backgroundColor=\"#903749\" fixed=\"true\">\n      <template v-slot:left>\n        <view class=\"navbar-title\">政策</view>\n      </template>\n    </uni-nav-bar>\n\n    <!-- 搜索栏 + 筛选栏 -->\n    <view class=\"fixed-top\">\n      <uni-search-bar \n        @confirm=\"search\" \n        placeholder=\"搜索政策或新闻\" \n        v-model=\"searchbar\" \n        @cancel=\"cancel\">\n      </uni-search-bar>\r\n\t  \r\n\t  <!-- tab切换 -->\r\n\t    <view>\r\n\t      <Tabswitch v-model=\"activeTab\" />\r\n\t  \r\n\t      <view v-if=\"activeTab === 'policy'\">\r\n\t        <!-- 政府政策内容 -->\r\n\t      </view>\r\n\t      <view v-else>\r\n\t        <!-- 行业新闻内容 -->\r\n\t      </view>\r\n\t    </view>\r\n\t  \n\n      <view class=\"filter-wrapper\">\n        <view class=\"filter-bar\">\n          <!-- 领域筛选 -->\n          <view class=\"filter-item\" @click=\"toggleDropdown('domain')\">\n            {{ selectedDomain.field_name || '全部领域' }}\n            <view class=\"arrow\" :class=\"{ open: currentDropdown === 'domain' }\"></view>\n          </view>\n\n          <!-- 时间筛选 -->\n          <view class=\"filter-item\" @click=\"toggleDropdown('time')\">\n            {{ selectedTime }}\n            <view class=\"arrow\" :class=\"{ open: currentDropdown === 'time' }\"></view>\n          </view>\n        </view>\n\n        <!-- 领域下拉 -->\n        <view v-if=\"currentDropdown === 'domain'\" class=\"dropdown-list\">\n          <view \n            class=\"dropdown-item\" \n            @click=\"selectOption('domain', null)\" \n            :class=\"{ selected: selectedDomain.field_id === 0 }\">\n            全部\n          </view>\n          <view \n            class=\"dropdown-item\" \n            v-for=\"item in field.fieldlist\" \n            :key=\"item.field_id\"\n            @click=\"selectOption('domain', item)\" \n            :class=\"{ selected: selectedDomain.field_id === item.field_id }\">\n            {{ item.field_name }}\n          </view>\n        </view>\n\n        <!-- 时间下拉 -->\n        <view v-if=\"currentDropdown === 'time'\" class=\"dropdown-list\">\n          <view \n            class=\"dropdown-item\" \n            v-for=\"item in timeList\" \n            :key=\"item\"\n            @click=\"selectOption('time', item)\" \n            :class=\"{ selected: selectedTime === item }\">\n            {{ item }}\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 政策列表 -->\r\n\t <view v-if=\"activeTab === 'policy'\">\n    <scroll-view class=\"news-scroll\" scroll-y=\"true\" @scrolltolower=\"loadMore\">\n      <view>\n        <uni-card \n          v-for=\"item in listarticles.listpolicy\" \n          :key=\"item.article_id\"\n          :title=\"item.article_title\" \n          :extra=\"Dataformat(item.release_time)\"\n          @click=\"OnClick(item.article_id)\">\n          <text>{{ item.brief_content }}</text>\n        </uni-card>\n\n        <view v-if=\"listarticles.loading\" class=\"loading\">加载中...</view>\n        <view v-else-if=\"!listarticles.hasMore\" class=\"no-more\">没有更多内容</view>\n      </view>\n    </scroll-view>\r\n\t</view>\r\n\t<!-- 新闻列表 -->\r\n\t<view v-else>\r\n\t  <scroll-view class=\"news-scroll\" scroll-y=\"true\" @scrolltolower=\"loadMore\">\r\n\t    <view>\r\n\t      <uni-card\r\n\t        v-for=\"item in listarticles.listnew\"\r\n\t        :key=\"item.article_id\"\r\n\t        :title=\"item.article_title\"\r\n\t        :extra=\"Dataformat(item.release_time)\"\r\n\t        :thumbnail=\"item.list_image_url\"\r\n\t        @click=\"OnClick(item.article_id)\">\r\n\t        <text class=\"uni-body\">{{ item.brief_content }}</text>\r\n\t      </uni-card>\r\n\t      <view v-if=\"listarticles.loading\" class=\"loading\">加载中...</view>\r\n\t      <view v-else-if=\"!listarticles.hasMore\" class=\"no-more\">没有更多内容</view>\r\n\t    </view>\r\n\t  </scroll-view>\r\n\t  \r\n\t</view>\r\n\t\r\n\t\n  </view>\n</template>\n\n\n<script setup>\nimport { ref, onMounted,watch } from 'vue'\nimport {useArticlesStore} from '@/store/Articles.js'\r\n\nimport { usefieldstore } from '@/store/field.js'\nimport { Dataformat } from '../../utils/data'\nimport { onShow } from '@dcloudio/uni-app'\r\nimport Tabswitch from '@/components/Tabswitch/Tabswitch.vue'\r\n\nconst listarticles = useArticlesStore()\nconst field = usefieldstore()\r\n\r\nconst activeTab = ref('policy')\n\n// 搜索栏\nconst searchbar = ref(\"\")\n\n// 当前打开的下拉框\nconst currentDropdown = ref(null)\n\n// 是否精选\nconst isselected=ref(0)\n\n// 初始值设为“全部”\nconst selectedDomain = ref({ field_id: 0, field_name: '全部' })\nconst selectedTime = ref('发布时间')\n\n// 时间列表\nconst timeList = ['全部', '最近一周', '最近一月', '最近一年']\r\n\r\n// 定义参数查询的结构体\r\nconst Params = { \n  field_id: 0,\n  page: 0,\n  is_selection: 0,\r\n  article_title: \"\",\r\n  release_time:\"\",\r\n  article_type:activeTab.value.toUpperCase()\n};\r\n\r\n// 监视器，监控activeTab的变化\r\nwatch(activeTab, (newVal, oldVal) => {\n  console.log('Tab 变化:', oldVal, '=>', newVal)\n  if (newVal === 'news') {\n    listarticles.resetpage(1)\r\n\tParams.article_type=\"NEWS\"\n  } else if (newVal === 'policy') {\n    listarticles.resetpage(1)\r\n\tParams.article_type=\"POLICY\"\n  }\n})\n\n// 搜索\nfunction search() {\r\n\tParams.article_title=searchbar.value\r\n\tParams.page=1\n  listarticles.getlistpolicy(Params)\n  console.log(\"搜索关键词:\", searchbar.value)\n}\n\n// 取消搜索\nfunction cancel() {\n  searchbar.value = \"\"\r\n  Params.page=1\r\n  Params.article_title=searchbar.value\r\n  listarticles.getlistpolicy(Params)\n}\n\n// 加载更多\nfunction loadMore() {\r\n Params.page=listarticles.page+1\r\nlistarticles.getarticlemore(Params)\n  console.log(\"到底了\")\n}\n\n// 切换下拉框\nfunction toggleDropdown(type) {\n  currentDropdown.value = currentDropdown.value === type ? null : type\n}\n\n// 选择筛选项\nfunction selectOption(type, value) {\n  if (type === 'domain') {\n    if (value === null) {\n      selectedDomain.value = { field_id: 0, field_name: '全部' }\r\n\t  Params.page=1\r\n\t  Params.field_id=selectedDomain.value.field_id\n      listarticles.getlistpolicy(Params)\n    } else {\n      selectedDomain.value = value\r\n\t  Params.page=1\r\n\t  Params.field_id=selectedDomain.value.field_id\n      listarticles.getlistpolicy(Params)\n    }\n  }\n\n  if (type === 'time') {\n    selectedTime.value = value\n  }\n\n  currentDropdown.value = null\n}\n\n// 跳转详情\nfunction OnClick(id) {\r\n\tconsole.log(\"测试的Id:\"+id)\n  uni.navigateTo({\n    url: `/pages/detail/articledetail?id=${id}`\n  })\n}\n// 在页面显示时判断来源\nonShow(() => {\n  const source = uni.getStorageSync('tabSource') || 'tabbar'\n\t\tfield.getfield()\n  if (source === 'switchTab') {\n    console.log('来源：通过 uni.switchTab() 跳转');\r\n\tParams.is_selection=1\r\n\tParams.page=1\r\n\tlistarticles.getlistpolicy(Params)\r\n\tParams.article_type=\"NEWS\"\r\n\tlistarticles.getlistpolicy(Params)\r\n\tParams.article_type=activeTab.value.toUpperCase()\n  } else {\n    console.log('来源：用户点击 tabBar 进入');\n\tisselected.value=0\r\n\tParams.page=1\n\tlistarticles.getlistpolicy(Params)\n\tParams.article_type=\"NEWS\"\r\n\tlistarticles.getlistpolicy(Params) \r\n\tParams.article_type=activeTab.value.toUpperCase()\n  }\n\n  // 清除标记，避免干扰下一次跳转\n  uni.removeStorageSync('tabSource')\n})\n\n</script>\n\n<style>\n@import url(\"../../style/new_policy.css\");\n.dropdown-list {\n  background-color: #fff;\n  border: 1px solid #ccc;\n  border-radius: 4rpx;\n  margin-top: 10rpx;\n}\n\n.dropdown-item {\n  padding: 20rpx;\n  font-size: 28rpx;\n  color: #333;\n}\n\n.dropdown-item.selected {\n  background-color: #f0f0f0;\n  font-weight: bold;\n}\n\n.filter-item {\n  /* padding: 20rpx;\n  font-size: 30rpx; */\n   padding: 12rpx 20rpx;\n   font-size: 30rpx;\n   display: flex;\n   align-items: center;\n   justify-content: space-between;\n}\n\n.arrow.open {\n  transform: rotate(180deg);\n}\n.loading,\n.no-more {\n  text-align: center;\n  color: #999;\n  padding: 20rpx;\n}\r\n\n</style>","import MiniProgramPage from 'E:/project/uniapp/uniapp-news/pages/policy/policy.vue'\nwx.createPage(MiniProgramPage)"],"names":["useArticlesStore","usefieldstore","ref","watch","uni","onShow","MiniProgramPage"],"mappings":"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"}