{"version":3,"file":"policy.js","sources":["pages/policy/policy.vue","D:/Hbuild/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcG9saWN5L3BvbGljeS52dWU"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <!-- 顶部固定导航栏 -->\n    <uni-nav-bar statusBar=\"true\" backgroundColor=\"#903749\" fixed=\"true\">\n      <template v-slot:left>\n        <view class=\"navbar-title\">咨询</view>\n      </template>\n    </uni-nav-bar>\n\n    <!-- 搜索栏 + 筛选栏 -->\n    <view class=\"fixed-top\">\n      <uni-search-bar \n        @confirm=\"search\" \n        placeholder=\"搜索政策或新闻\" \n        v-model=\"searchbar\" \n        @cancel=\"cancel\">\n      </uni-search-bar>\n\t  \n\t  <!-- tab切换 -->\n\t    <view>\n\t      <Tabswitch v-model=\"activeTab\" />\n\t  \n\t      <view v-if=\"activeTab === 'policy'\">\n\t        <!-- 政府政策内容 -->\n\t      </view>\n\t      <view v-else>\n\t        <!-- 行业新闻内容 -->\n\t      </view>\n\t    </view>\n\t  \n\n      <view class=\"filter-wrapper\">\n        <view class=\"filter-bar\">\n          <!-- 领域筛选 -->\n          <view class=\"filter-item\" @click=\"toggleDropdown('domain')\">\n            <view class=\"filter-content\">\n              <text class=\"filter-icon\">🏷️</text>\n              <text class=\"filter-text\">{{ selectedDomain.field_name || '全部领域' }}</text>\n              <view class=\"arrow\" :class=\"{ open: currentDropdown === 'domain' }\"></view>\n            </view>\n          </view>\n\n          <!-- 时间筛选 -->\n          <view class=\"filter-item\" @click=\"toggleDropdown('time')\">\n            <view class=\"filter-content\">\n              <text class=\"filter-icon\">📅</text>\n              <text class=\"filter-text\">{{ selectedTime }}</text>\n              <view class=\"arrow\" :class=\"{ open: currentDropdown === 'time' }\"></view>\n            </view>\n          </view>\n        </view>\n\n        <!-- 下拉遮罩 -->\n        <view v-if=\"currentDropdown\" class=\"dropdown-overlay\" @click=\"currentDropdown = null\"></view>\n\n        <!-- 领域下拉 -->\n        <view v-if=\"currentDropdown === 'domain'\" class=\"dropdown-list\">\n          <view class=\"dropdown-header\">选择领域</view>\n          <view \n            class=\"dropdown-item\" \n            @click=\"selectOption('domain', null)\" \n            :class=\"{ selected: selectedDomain.field_id === 0 }\">\n            <text class=\"item-icon\">🌐</text>\n            <text class=\"item-text\">全部</text>\n            <text v-if=\"selectedDomain.field_id === 0\" class=\"check-icon\">✓</text>\n          </view>\n          <view \n            class=\"dropdown-item\" \n            v-for=\"item in field.fieldlist\" \n            :key=\"item.field_id\"\n            @click=\"selectOption('domain', item)\" \n            :class=\"{ selected: selectedDomain.field_id === item.field_id }\">\n            <text class=\"item-icon\">📁</text>\n            <text class=\"item-text\">{{ item.field_name }}</text>\n            <text v-if=\"selectedDomain.field_id === item.field_id\" class=\"check-icon\">✓</text>\n          </view>\n        </view>\n\n        <!-- 时间下拉 -->\n        <view v-if=\"currentDropdown === 'time'\" class=\"dropdown-list\">\n          <view class=\"dropdown-header\">选择时间</view>\n          <view \n            class=\"dropdown-item\" \n            v-for=\"item in timeList\" \n            :key=\"item\"\n            @click=\"selectOption('time', item)\" \n            :class=\"{ selected: selectedTime === item }\">\n            <text class=\"item-icon\">⏰</text>\n            <text class=\"item-text\">{{ item }}</text>\n            <text v-if=\"selectedTime === item\" class=\"check-icon\">✓</text>\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 政策列表 -->\n\t <view v-if=\"activeTab === 'policy'\">\n    <scroll-view class=\"news-scroll\" scroll-y=\"true\" @scrolltolower=\"loadMore\">\n      <view>\n        <!-- <uni-card \n          v-for=\"item in listarticles.listpolicy\" \n          :key=\"item.article_id\"\n          :title=\"item.article_title\" \n          :extra=\"Dataformat(item.release_time)\"\n          @click=\"OnClick(item.article_id)\">\n          <text>{{ item.brief_content }}</text>\n        </uni-card> -->\n\t\t<ArticlePolicyVue \n\t\t        v-for=\"item in listarticles.listpolicy\" \n\t\t        :key=\"item.article_id\"\n\t\t        :policyData=\"item\"\n\t\t        @click=\"handlePolicyClick\"\n\n\t\t />\n\n        <view v-if=\"listarticles.loading\" class=\"loading\">加载中...</view>\n        <view v-else-if=\"!listarticles.hasMore\" class=\"no-more\">没有更多内容</view>\n      </view>\n    </scroll-view>\n\t</view>\n\t<!-- 新闻列表 -->\n\t<view v-else>\n\t  <scroll-view class=\"news-scroll\" scroll-y=\"true\" @scrolltolower=\"loadMore\">\n\t    <view>\n\t      <!-- <uni-card\n\t        v-for=\"item in listarticles.listnew\"\n\t        :key=\"item.article_id\"\n\t        :title=\"item.article_title\"\n\t        :extra=\"Dataformat(item.release_time)\"\n\t        :thumbnail=\"item.cover_image_url\"\n\t        @click=\"OnClick(item.article_id)\">\n\t        <text class=\"uni-body\">{{ item.brief_content }}</text>\n\t      </uni-card> -->\n\t\t  <ArticleCard \n\t\t        v-for=\"item in listarticles.listnew\" \n\t\t               :key=\"item.article_id\"\n\t\t               :newsData=\"item\"\n\t\t               @click=\"handleNewsClick\"   \n\t\t\t/>\n\t      <view v-if=\"listarticles.loading\" class=\"loading\">加载中...</view>\n\t      <view v-else-if=\"!listarticles.hasMore\" class=\"no-more\">没有更多内容</view>\n\t    </view>\n\t  </scroll-view>\n\t  \n\t</view>\n\t\n\t\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted,watch } from 'vue'\nimport {useArticlesStore} from '@/store/Articles.js'\nimport { usefieldstore } from '@/store/field.js'\nimport { Dataformat,formatDate,getLastWeekDate,getLastMonthDate,getLastYearDate } from '../../utils/data'\nimport { onShow } from '@dcloudio/uni-app'\nimport Tabswitch from '@/components/Tabswitch/Tabswitch.vue'\nimport ArticleCard from '@/components/ArticleCard/ArticleCard.vue'\nimport ArticlePolicyVue from '../../components/ArticleCard/ArticlePolicy.vue'\n\n\n\n\n\n\nconst listarticles = useArticlesStore()\nconst field = usefieldstore()\n\nconst activeTab = ref('policy')\n\n// 搜索栏\nconst searchbar = ref(\"\")\n\n// 当前打开的下拉框\nconst currentDropdown = ref(null)\n\n// 是否精选\nconst isselected=ref(0)\n\n// 初始值设为\"全部\"\nconst selectedDomain = ref({ field_id: 0, field_name: '全部' })\nconst selectedTime = ref('发布时间')\n\n// 时间列表\nconst timeList = ['全部', '最近一周', '最近一月', '最近一年']\n\n// 定义参数查询的结构体\nconst Params = { \n  field_id: 0,\n  page: 0,\n  is_selection: 0,\n  article_title: \"\",\n  release_time:\"\",\n  article_type:activeTab.value.toUpperCase()\n};\n\n// 监视器，监控activeTab的变化\nwatch(activeTab, (newVal, oldVal) => {\n  console.log('Tab 变化:', oldVal, '=>', newVal)\n  if (newVal === 'news') {\n    listarticles.resetpage(1)\n\tParams.article_type=\"NEWS\"\n  } else if (newVal === 'policy') {\n    listarticles.resetpage(1)\n\tParams.article_type=\"POLICY\"\n  }\n})\n\n// 搜索\nfunction search() {\n\tParams.article_title=searchbar.value\n\tParams.page=1\n  listarticles.getlistpolicy(Params)\n  console.log(\"搜索关键词:\", searchbar.value)\n}\n\n// 取消搜索\nfunction cancel() {\n  searchbar.value = \"\"\n  Params.page=1\n  Params.article_title=searchbar.value\n  listarticles.getlistpolicy(Params)\n}\n\n// 加载更多\nfunction loadMore() {\n Params.page=listarticles.page+1\nlistarticles.getarticlemore(Params)\n  console.log(\"到底了\")\n}\n\n// 切换下拉框\nfunction toggleDropdown(type) {\n  currentDropdown.value = currentDropdown.value === type ? null : type\n}\n\n// 选择筛选项\nfunction selectOption(type, value) {\n  if (type === 'domain') {\n    if (value === null) {\n      selectedDomain.value = { field_id: 0, field_name: '全部' }\n\t  Params.page=1\n\t  Params.field_id=selectedDomain.value.field_id\n      listarticles.getlistpolicy(Params)\n    } else {\n      selectedDomain.value = value\n\t  Params.page=1\n\t  Params.field_id=selectedDomain.value.field_id\n      listarticles.getlistpolicy(Params)\n    }\n  }\n\n  if (type === 'time') {\r\n\t  console.log(value)\n    selectedTime.value = value\r\n\tif (value === '最近一周') {\r\n\t      // 计算并更新为最近一周\r\n\t      Params.release_time = getLastWeekDate();\r\n\t    } else if (value === '最近一月') {\r\n\t      // 计算并更新为最近一月\r\n\t      Params.release_time = getLastMonthDate();\r\n\t    } else if (value === '最近一年') {\r\n\t      // 计算并更新为最近一年\r\n\t      Params.release_time = getLastYearDate();\r\n\t    } else {\r\n\t      // 清空时间筛选\r\n\t      Params.release_time = '';\r\n\t    }\r\n\t\r\n\t    Params.page = 1;\r\n\t    listarticles.getlistpolicy(Params);\n  }\n\n  currentDropdown.value = null\n}\n\n// 处理政策点击\nconst handlePolicyClick = (policyItem) => {\n  console.log('点击了政策:', policyItem)\n  uni.navigateTo({\n    url: `/pages/detail/articledetail?id=${policyItem.article_id}`\n  })\n}\n\n// 处理新闻点击\nconst handleNewsClick = (newsItem) => {\n  console.log('点击了新闻:', newsItem.article_id)\n  uni.navigateTo({\n    url: `/pages/detail/articledetail?id=${newsItem.article_id}`\n  })\n}\n\n// 处理预览\nconst handlePreview = (policyItem) => {\n  console.log('预览政策:', policyItem)\n  uni.navigateTo({\n    url: `/pages/policy-preview/policy-preview?id=${policyItem.id}`\n  })\n}\n\n// // 处理下载\n// const handleDownload = (policyItem) => {\n//   console.log('下载政策:', policyItem)\n//   uni.showToast({\n//     title: '开始下载',\n//     icon: 'success'\n//   })\n// }\n\n// 跳转详情\nfunction OnClick(id) {\n\tconsole.log(\"测试的Id:\"+id)\n  uni.navigateTo({\n    url: `/pages/detail/articledetail?id=${id}`\n  })\n}\n// 在页面显示时判断来源\nonShow(() => {\n  const source = uni.getStorageSync('tabSource') || 'tabbar'\n\t\tfield.getfield()\n  if (source === 'switchTab') {\n    console.log('来源：通过 uni.switchTab() 跳转');\n\tParams.is_selection=1\n\tParams.page=1\n\tlistarticles.getlistpolicy(Params)\n\tParams.article_type=\"NEWS\"\n\tlistarticles.getlistpolicy(Params)\n\tParams.article_type=activeTab.value.toUpperCase()\n  } else {\n    console.log('来源：用户点击 tabBar 进入');\n\tisselected.value=0\n\tParams.page=1\n\tlistarticles.getlistpolicy(Params)\n\tParams.article_type=\"NEWS\"\n\tlistarticles.getlistpolicy(Params) \n\tParams.article_type=activeTab.value.toUpperCase()\n  }\n\n  // 清除标记，避免干扰下一次跳转\n  uni.removeStorageSync('tabSource')\n})\n\n</script>\n\n<style>\n.page {\n  height: 100vh;\n  overflow: hidden;\n  position: relative;\n}\n\n/* 固定顶部区域（搜索 + 筛选） */\n.fixed-top {\n  position: fixed;\n  top: 178rpx;\n  left: 0;\n  right: 0;\n  z-index: 10;\n  background-color: #ffffff;\n  padding-bottom: 20rpx;\n  box-shadow: 0 4rpx 10rpx rgba(0, 0, 0, 0.05);\n}\n\n/* 滚动区域 */\n.news-scroll {\n  position: fixed;\n  top: calc(178rpx + 260rpx);\n  bottom: var(--window-bottom);\n  left: 0;\n  right: 0;\n  overflow-y: scroll;\n  padding: 5rpx;\n  background-color: #f5f5f5;\n}\n\n/* 导航栏标题 */\n.navbar-title {\n  font-size: 20px;\n  font-weight: bold;\n  color: white;\n}\n\n/* 筛选区域 */\n.filter-wrapper {\n  position: relative;\n  z-index: 1;\n}\n\n.filter-bar {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding: 16rpx 20rpx;\n  background-color: #fff;\n  gap: 20rpx;\n}\n\n.filter-item {\n  flex: 1;\n  background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);\n  border-radius: 16rpx;\n  border: 2rpx solid #e8e8ff;\n  transition: all 0.3s ease;\n}\n\n.filter-item.active {\n  transform: scale(0.98);\n  background: linear-gradient(135deg, #f0f2ff 0%, #e8e8ff 100%);\n}\n\n.filter-content {\n  display: flex;\n  align-items: center;\n  padding: 16rpx 20rpx;\n  gap: 12rpx;\n}\n\n.filter-content .filter-icon {\n  font-size: 28rpx;\n}\n\n.filter-content .filter-text {\n  flex: 1;\n  font-size: 28rpx;\n  color: #333;\n  font-weight: 500;\n}\n\n.arrow {\n  width: 0;\n  height: 0;\n  border-left: 8rpx solid transparent;\n  border-right: 8rpx solid transparent;\n  border-top: 10rpx solid #666;\n  transition: transform 0.3s ease;\n}\n\n.arrow.open {\n  transform: rotate(180deg);\n}\n\n/* 下拉遮罩 */\n.dropdown-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.3);\n  z-index: 98;\n}\n\n/* 下拉列表 */\n.dropdown-list {\n  position: absolute;\n  top: 100%;\n  left: 20rpx;\n  right: 20rpx;\n  background: #fff;\n  border-radius: 16rpx;\n  box-shadow: 0 12rpx 40rpx rgba(0, 0, 0, 0.15);\n  z-index: 99;\n  max-height: 600rpx;\n  overflow-y: auto;\n}\n\n.dropdown-list .dropdown-header {\n  padding: 20rpx 24rpx 12rpx;\n  font-size: 26rpx;\n  font-weight: 600;\n  color: #666;\n  border-bottom: 1rpx solid #f0f0f0;\n}\n\n.dropdown-list .dropdown-item {\n  display: flex;\n  align-items: center;\n  padding: 20rpx 24rpx;\n  gap: 16rpx;\n  transition: background-color 0.2s ease;\n}\n\n.dropdown-list .dropdown-item:active {\n  background: #f5f5f5;\n}\n\n.dropdown-list .dropdown-item.selected {\n  background: linear-gradient(135deg, #667eea10 0%, #764ba210 100%);\n}\n\n.dropdown-list .dropdown-item.selected .item-text {\n  color: #667eea;\n  font-weight: 600;\n}\n\n.dropdown-list .dropdown-item .item-icon {\n  font-size: 24rpx;\n}\n\n.dropdown-list .dropdown-item .item-text {\n  flex: 1;\n  font-size: 28rpx;\n  color: #333;\n}\n\n.dropdown-list .dropdown-item .check-icon {\n  font-size: 28rpx;\n  color: #667eea;\n  font-weight: 700;\n}\n\n.loading,\n.no-more {\n  text-align: center;\n  color: #999;\n  padding: 20rpx;\n}\n\n</style>","import MiniProgramPage from 'E:/project/uniapp/uniapp-news/pages/policy/policy.vue'\nwx.createPage(MiniProgramPage)"],"names":["useArticlesStore","usefieldstore","ref","watch","uni","getLastWeekDate","getLastMonthDate","getLastYearDate","onShow","MiniProgramPage"],"mappings":"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"}