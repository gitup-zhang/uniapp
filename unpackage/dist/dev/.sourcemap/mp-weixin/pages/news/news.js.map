{"version":3,"file":"news.js","sources":["pages/news/news.vue","D:/Hbuild/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbmV3cy9uZXdzLnZ1ZQ"],"sourcesContent":["<template> \n  <view class=\"page\">\n    <!-- 顶部固定导航栏 -->\n    <uni-nav-bar statusBar=\"true\" backgroundColor=\"#903749\" fixed=\"true\">\n      <template v-slot:left>\n        <view class=\"navbar-title\">新闻</view>\n      </template>\n    </uni-nav-bar>\n\n    <!-- 搜索栏 + 筛选栏 -->\n    <view class=\"fixed-top\">\n      <uni-search-bar \n        @confirm=\"search\" \n        placeholder=\"搜索行业新闻\" \n        v-model=\"searchbar\" \n        @cancel=\"cancel\">\n      </uni-search-bar>\n\n      <view class=\"filter-wrapper\">\n        <view class=\"filter-bar\">\n          <!-- 领域筛选 -->\n          <view class=\"filter-item\" @click=\"toggleDropdown('domain')\">\n            {{ selectedDomain.field_name || '全部领域' }}\n            <view class=\"arrow\" :class=\"{ open: currentDropdown === 'domain' }\"></view>\n          </view>\n\n          <!-- 时间筛选 -->\n          <view class=\"filter-item\" @click=\"toggleDropdown('time')\">\n            {{ selectedTime }}\n            <view class=\"arrow\" :class=\"{ open: currentDropdown === 'time' }\"></view>\n          </view>\n        </view>\n\n        <!-- 领域下拉 -->\n        <view v-if=\"currentDropdown === 'domain'\" class=\"dropdown-list\">\n          <view \n            class=\"dropdown-item\" \n            @click=\"selectOption('domain', null)\" \n            :class=\"{ selected: selectedDomain.field_id === 0 }\">\n            全部\n          </view>\n          <view \n            class=\"dropdown-item\" \n            v-for=\"item in field.fieldlist\" \n            :key=\"item.field_id\"\n            @click=\"selectOption('domain', item)\" \n            :class=\"{ selected: selectedDomain.field_id === item.field_id }\">\n            {{ item.field_name }}\n          </view>\n        </view>\n\n        <!-- 时间下拉 -->\n        <view v-if=\"currentDropdown === 'time'\" class=\"dropdown-list\">\n          <view \n            class=\"dropdown-item\" \n            v-for=\"item in timeList\" \n            :key=\"item\"\n            @click=\"selectOption('time', item)\" \n            :class=\"{ selected: selectedTime === item }\">\n            {{ item }}\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 新闻列表 -->\n    <scroll-view class=\"news-scroll\" scroll-y=\"true\" @scrolltolower=\"loadMore\">\n      <view>\n        <uni-card\n          v-for=\"item in listnew.listnew\"\n          :key=\"item.id\"\n          :title=\"item.new_title\"\n          :extra=\"Dataformat(item.release_time)\"\n          :thumbnail=\"item.list_image_url\"\n          @click=\"onClick(item.id)\">\n          <text class=\"uni-body\">{{ item.brief_content }}</text>\n        </uni-card>\n        <view v-if=\"listnew.loading\" class=\"loading\">加载中...</view>\n        <view v-else-if=\"!listnew.hasMore\" class=\"no-more\">没有更多内容</view>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { useNewStore } from '../../store/NewList'\nimport { usefieldstore } from '../../store/field.js'\nimport { Dataformat } from '../../utils/data'\nimport { onShow } from '@dcloudio/uni-app'\nconst listnew = useNewStore()\nconst field = usefieldstore()\n\nconst searchbar = ref(\"\")\nconst currentDropdown = ref(null)\r\n// 是否精选\r\nconst isselected=ref(0)\n\n// 初始化“全部”\nconst selectedDomain = ref({ field_id: 0, field_name: '全部' })\nconst selectedTime = ref('发布时间')\n\nconst timeList = ['全部', '最近一周', '最近一月', '最近一年']\n\n// 加载更多\nconst loadMore = () => {\n  listnew.getmorelist({\n    policyTitle: searchbar.value,\n    fieldID: selectedDomain.value.field_id,\n    page: listnew.page + 1,\r\n\tis_selection: isselected.value\n  })\n  console.log(\"到底了\")\n}\n\n// 搜索\nfunction search() {\n  listnew.searchnewlist({\n    newTitle: searchbar.value,\n    fieldID: selectedDomain.value.field_id\n  })\n  console.log(\"搜索关键词:\", searchbar.value)\n}\n\n// 取消搜索\nfunction cancel() {\n  searchbar.value = \"\"\n  listnew.getlistnew({})\n}\n\n// 切换下拉框\nfunction toggleDropdown(type) {\n  currentDropdown.value = currentDropdown.value === type ? null : type\n}\n\n// 选择筛选项\nfunction selectOption(type, value) {\n  if (type === 'domain') {\n    if (value === null) {\n      selectedDomain.value = { field_id: 0, field_name: '全部' }\n      listnew.getlistnew({})\n    } else {\n      selectedDomain.value = value\n      listnew.searchnewlist({ fieldID: value.field_id })\n    }\n  }\n\n  if (type === 'time') {\n    selectedTime.value = value\n  }\n\n  currentDropdown.value = null\n}\n\n// 跳转新闻详情\nfunction onClick(id) {\n  uni.navigateTo({\n    url: `/pages/detail/detailnew?id=${id}`\n  })\n}\n// 在页面显示时判断来源\nonShow(() => {\n  const source = uni.getStorageSync('tabSource') || 'tabbar'\n\n  if (source === 'switchTab') {\n    console.log('来源：通过 uni.switchTab() 跳转');\r\n\tisselected.value=1\r\n\tlistnew.getlistnew({is_selection:isselected.value})\n    // 可以执行特定逻辑，比如刷新数据\n  } else {\n    console.log('来源：用户点击 tabBar 进入');\r\n\tisselected.value=0\r\n\t listnew.getlistnew({})\r\n\tfield.getfield()\n  }\n\n  // 清除标记，避免干扰下一次跳转\n  uni.removeStorageSync('tabSource')\n})\n// onMounted(() => {\n \n// })\n</script>\n<style>\n@import url(\"../../style/new_policy.css\");\n\n.dropdown-list {\n  background-color: #fff;\n  border: 1px solid #ccc;\n  border-radius: 4rpx;\n  margin-top: 10rpx;\n}\n\n.dropdown-item {\n  padding: 20rpx;\n  font-size: 28rpx;\n  color: #333;\n}\n\n.dropdown-item.selected {\n  background-color: #f0f0f0;\n  font-weight: bold;\n}\n\n.filter-item {\n  /* padding: 20rpx;\n  font-size: 30rpx; */\r\n   padding: 12rpx 20rpx;\r\n   font-size: 30rpx;\r\n   display: flex;\r\n   align-items: center;\r\n   justify-content: space-between;\n}\n\n.arrow.open {\n  transform: rotate(180deg);\n}\r\n.loading,\n.no-more {\n  text-align: center;\n  color: #999;\n  padding: 20rpx;\n}\n</style>\n","import MiniProgramPage from 'E:/project/uniapp/uniapp-news/pages/news/news.vue'\nwx.createPage(MiniProgramPage)"],"names":["useNewStore","usefieldstore","ref","uni","onShow","MiniProgramPage"],"mappings":";;;;;;;;;;;;;;;;;;;;AA0FA,UAAM,UAAUA,cAAAA,YAAa;AAC7B,UAAM,QAAQC,YAAAA,cAAe;AAE7B,UAAM,YAAYC,cAAG,IAAC,EAAE;AACxB,UAAM,kBAAkBA,cAAG,IAAC,IAAI;AAEhC,UAAM,aAAWA,cAAG,IAAC,CAAC;AAGtB,UAAM,iBAAiBA,cAAG,IAAC,EAAE,UAAU,GAAG,YAAY,MAAM;AAC5D,UAAM,eAAeA,cAAG,IAAC,MAAM;AAE/B,UAAM,WAAW,CAAC,MAAM,QAAQ,QAAQ,MAAM;AAG9C,UAAM,WAAW,MAAM;AACrB,cAAQ,YAAY;AAAA,QAClB,aAAa,UAAU;AAAA,QACvB,SAAS,eAAe,MAAM;AAAA,QAC9B,MAAM,QAAQ,OAAO;AAAA,QACxB,cAAc,WAAW;AAAA,MAC1B,CAAG;AACDC,oBAAAA,MAAY,MAAA,OAAA,8BAAA,KAAK;AAAA,IACnB;AAGA,aAAS,SAAS;AAChB,cAAQ,cAAc;AAAA,QACpB,UAAU,UAAU;AAAA,QACpB,SAAS,eAAe,MAAM;AAAA,MAClC,CAAG;AACDA,oBAAY,MAAA,MAAA,OAAA,8BAAA,UAAU,UAAU,KAAK;AAAA,IACvC;AAGA,aAAS,SAAS;AAChB,gBAAU,QAAQ;AAClB,cAAQ,WAAW,EAAE;AAAA,IACvB;AAGA,aAAS,eAAe,MAAM;AAC5B,sBAAgB,QAAQ,gBAAgB,UAAU,OAAO,OAAO;AAAA,IAClE;AAGA,aAAS,aAAa,MAAM,OAAO;AACjC,UAAI,SAAS,UAAU;AACrB,YAAI,UAAU,MAAM;AAClB,yBAAe,QAAQ,EAAE,UAAU,GAAG,YAAY,KAAM;AACxD,kBAAQ,WAAW,EAAE;AAAA,QAC3B,OAAW;AACL,yBAAe,QAAQ;AACvB,kBAAQ,cAAc,EAAE,SAAS,MAAM,SAAQ,CAAE;AAAA,QAClD;AAAA,MACF;AAED,UAAI,SAAS,QAAQ;AACnB,qBAAa,QAAQ;AAAA,MACtB;AAED,sBAAgB,QAAQ;AAAA,IAC1B;AAGA,aAAS,QAAQ,IAAI;AACnBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,8BAA8B,EAAE;AAAA,MACzC,CAAG;AAAA,IACH;AAEAC,kBAAAA,OAAO,MAAM;AACX,YAAM,SAASD,cAAG,MAAC,eAAe,WAAW,KAAK;AAElD,UAAI,WAAW,aAAa;AAC1BA,sBAAAA,MAAA,MAAA,OAAA,8BAAY,0BAA0B;AACzC,mBAAW,QAAM;AACjB,gBAAQ,WAAW,EAAC,cAAa,WAAW,MAAK,CAAC;AAAA,MAEnD,OAAS;AACLA,sBAAAA,MAAY,MAAA,OAAA,8BAAA,mBAAmB;AAClC,mBAAW,QAAM;AAChB,gBAAQ,WAAW,EAAE;AACtB,cAAM,SAAU;AAAA,MACd;AAGDA,oBAAG,MAAC,kBAAkB,WAAW;AAAA,IACnC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjLD,GAAG,WAAWE,SAAe;"}