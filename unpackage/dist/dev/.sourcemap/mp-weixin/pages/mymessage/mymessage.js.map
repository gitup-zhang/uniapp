{"version":3,"file":"mymessage.js","sources":["pages/mymessage/mymessage.vue","D:/Hbuild/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbXltZXNzYWdlL215bWVzc2FnZS52dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 原有的页面内容保持不变 -->\n    <view class=\"header\">\n      <view class=\"status-bar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\n      <view class=\"header-top-bar\">\n        <text class=\"title-text\">我的</text>\n        <view class=\"settings-icon\" @click=\"openset\">\n          <uni-icons type=\"gear-filled\" size=\"22\" color=\"#fff\" v-if=\"userInfo.signal\"/>\n        </view>\n      </view>\n      <view class=\"header-content\">\n        <image class=\"avatar\"  :src=\"userInfo.info.Image ? userInfo.info.Image : '/static/icon/empty.png'\" mode=\"aspectFill\"></image>\n        <view class=\"user-info\">\n          <!-- <text class=\"username\" @click=\"admin\">{{ userInfo.info.username || '点击登录' }}</text> -->\r\n\t\t  <button class=\"username-button\" open-type=\"getPhoneNumber\" @getphonenumber=\"getPhoneNumber\">\r\n\t\t    {{ userInfo.info.username || '点击登录' }}\r\n\t\t  </button>\n          <text class=\"slogan\">{{ userInfo.info.slogan || '请登录后设置个人签名' }}</text>\n        </view>\n      </view>\n    </view>\n    <view class=\"main-content\">\n      <view class=\"card\">\n          <view class=\"top-section\">\n                  <image class=\"icon\" src=\"/static/icon/fire.png\" mode=\"aspectFit\"></image>\n                  <view class=\"title-group\">\n                    <text class=\"card-title\">累计在线天数</text>\n                    <text class=\"card-number\">{{ userInfo.info.daysOnline }}</text>\n                  </view>\n                </view>\n        \n                <view class=\"bottom-section\">\n                  <view class=\"bottom-item\">\n                    <text class=\"bottom-number\">{{ userInfo.info.newsViews }}</text>\n                    <text class=\"bottom-label\">查看新闻数</text>\n                  </view>\n                  <view class=\"vertical-line\"></view>\n                  <view class=\"bottom-item\">\n                    <text class=\"bottom-number\">{{ userInfo.info.policyViews }}</text>\n                    <text class=\"bottom-label\">查看政策数</text>\n                  </view>\n                  <view class=\"vertical-line\"></view>\n                  <view class=\"bottom-item\">\n                    <text class=\"bottom-number\">{{ userInfo.info.field }}</text>\n                    <text class=\"bottom-label\">关注领域</text>\n                  </view>\n                </view>\n      </view>\n    </view>\n\n    <!-- 优化后的弹窗组件 -->\n    <uni-popup ref=\"popupRef\" type=\"bottom\" :custom-style=\"popupStyle\">\n      <view class=\"setting-popup\">\n        <!-- 标题栏 -->\n        <view class=\"popup-header\">\n          <text class=\"popup-title\">设置</text>\n        </view>\n        \n        <!-- 分割线 -->\n        <view class=\"popup-divider\"></view>\n        \n        <!-- 功能项 -->\n        <view class=\"popup-item\" @click=\"logout\">\n          <uni-icons type=\"logout\" size=\"24\" color=\"#ff4d4f\" />\n          <text class=\"item-text\">退出登录</text>\n        </view>\n        \n        <!-- 取消按钮 -->\n        <view class=\"popup-cancel\" @click=\"closePopup\">\n          <text>取消</text>\n        </view>\n      </view>\n    </uni-popup>\n  </view>\n  \n<view>\n\t\t\t<!-- 提示窗示例 -->\n\t\t\t<uni-popup ref=\"alertDialog\" type=\"dialog\">\n\t\t\t\t<uni-popup-dialog type=\"info\" cancelText=\"关闭\" confirmText=\"同意\" title=\"通知\" content=\"是否确认登录\" @confirm=\"dialogConfirm\"\n\t\t\t\t\t@close=\"dialogClose\"></uni-popup-dialog>\n\t\t\t</uni-popup>\n</view>\n  \n</template>\n\n<script setup>\nimport { ref, computed ,onMounted} from 'vue'\nimport uniPopup from '@dcloudio/uni-ui/lib/uni-popup/uni-popup.vue'\nimport {useInfoStore} from '@/store/Info.js'\n\n// 初始化pinia对象\nconst userInfo=useInfoStore()\n\n// 获取系统信息\nconst SYSTEMINFO = uni.getSystemInfoSync()\nconst popupRef = ref(null)\nconst statusBarHeight = ref(SYSTEMINFO.statusBarHeight)\n\n\n\n// 底部导航栏高度（默认50px，可根据实际情况调整）\nconst tabBarHeight = ref(50)\n\n// 弹窗样式（关键优化点：避开底部导航栏）\nconst popupStyle = computed(() => ({\n  'border-radius': '20rpx 20rpx 0 0',\n  'bottom': `${tabBarHeight.value}px`, // 关键：设置底部偏移量\n  'z-index': 9999, // 确保弹窗在最上层\n  'max-width': '750rpx', // 限制最大宽度\n  'margin': '0 auto',\n  'background-color': 'transparent' // 外层透明，让圆角显示\n}))\n\n// 确认登录弹窗\nconst alertDialog = ref(null)  \n// 页面挂载钩子\nonMounted(()=>{\n\t// userInfo.getinfo()\n\t\n\t\n})\r\nconst getPhoneNumber = async (e) => {\r\n\tuserInfo.loginWithWeChat()\n  if (e.detail.errMsg !== 'getPhoneNumber:ok') {\r\n\t  console.log(e)\n    uni.showToast({ title: '用户拒绝授权', icon: 'none' })\n    return\n  }\n\n  // const { encryptedData, iv } = e.detail\r\n}\nconst admin=async()=>{\n\tif(userInfo.signal){\n\t\tconsole.log(\"已登录\")\n\t}else{\n\t\t// const loginRes = await uni.login();\n\t\t\n\t\t// console.log(loginRes)\n\t\t\n\t\t// userInfo.getinfo()\n\t\tuserInfo.loginWithWeChat()\n\t\t// 打开确定登录的弹窗\n\t\talertDialog.value.open()\n\t\t\n\t}\n}\n// 确认登录弹窗的确定和取消函数\nfunction dialogConfirm() {\n  console.log('用户点击了同意')\n  alertDialog.value.close()\n  // 这里可继续处理登录逻辑\n  userInfo.getUserProfile()\n}\n\n\n\n// 打开弹窗\nfunction openset() {\n  popupRef.value.open()\n}\n\n// 关闭弹窗\nfunction closePopup() {\n  popupRef.value.close()\n}\n\n// 退出登录\nfunction logout() {\n  uni.showModal({\n    title: '确认退出',\n    content: '您确定要退出当前账号吗？',\n    confirmColor: '#ff4d4f',\n    success: (res) => {\n      if (res.confirm) {\n        // 清空用户信息\n        userInfo.deleteinfo()\n        // 关闭弹窗\n        closePopup()\n        // 提示用户\n        uni.showToast({\n          title: '已退出登录',\n          icon: 'none'\n        })\n      }\n    }\n  })\n}\n</script>\n\n<style lang=\"scss\">\n\t.container {\n\t  min-height: 100vh;\n\t  background-color: #f5f5f5;\n\t  padding-bottom: env(safe-area-inset-bottom); // 防止底部内容被遮挡\n\t}\n\t\n\t.header {\n\t  background: linear-gradient(to right, #ff4d4f, #ff7a7a);\n\t  padding: 0 20rpx;\n\t  padding-top: env(safe-area-inset-top); // 适配刘海屏顶部\n\t  position: relative;\n\t  height: 600rpx;\n\t  box-sizing: border-box;\n\t\n\t  .status-bar {\n\t    height: var(--status-bar-height); // 或动态赋值\n\t  }\n\t\n\t  .header-top-bar {\n\t    display: flex;\n\t    justify-content: space-between;\n\t    align-items: center;\n\t    padding-top: 20rpx;\n\t\n\t    .title-text {\n\t      font-size: 36rpx;\n\t      font-weight: bold;\n\t      color: #fff;\n\t    }\n\t\n\t    .settings-icon {\n\t      width: 60rpx;\n\t      height: 60rpx;\n\t    }\n\t  }\n\t\n\t  .header-content {\n\t    display: flex;\n\t    align-items: center;\n\t    padding-top: 150rpx;\n\t\n\t    .avatar {\n\t      width: 140rpx;\n\t      height: 140rpx;\n\t      border-radius: 50%;\n\t      border: 4rpx solid #fff;\n\t      margin-right: 30rpx;\n\t    }\n\t\n\t    .user-info {\n\t      display: flex;\n\t      flex-direction: column;\n\t      color: #fff;\n\t\n\t      .username {\n\t        font-size: 40rpx;\n\t        font-weight: bold;\n\t        margin-bottom: 8rpx;\n\t      }\n\t\n\t      .slogan {\n\t        font-size: 28rpx;\n\t        opacity: 0.9;\n\t      }\n\t    }\n\t  }\n\t}\n\t\n\t.main-content {\n\t  position: relative;\n\t  z-index: 2;\n\t  padding: 0 32rpx;\n\t  margin-top: -100rpx;\n\t}\n\t\n\t.card {\n\t  background-color: #fff;\n\t  border-radius: 28rpx;\n\t  box-shadow: 0 16rpx 40rpx rgba(0, 0, 0, 0.08);\n\t  padding: 40rpx;\n\t}\n\t\n\t.top-section {\n\t  display: flex;\n\t  align-items: center;\n\t  margin-bottom: 40rpx;\n\t\n\t  .icon {\n\t    width: 60rpx;\n\t    height: 60rpx;\n\t    margin-right: 20rpx;\n\t  }\n\t\n\t  .title-group {\n\t    display: flex;\n\t    flex-direction: column;\n\t\n\t    .card-title {\n\t      font-weight: bold;\n\t      font-size: 32rpx;\n\t      color: #333;\n\t    }\n\t\n\t    .card-number {\n\t      font-size: 48rpx;\n\t      font-weight: bold;\n\t      color: #ff4d4f;\n\t      margin-top: 8rpx;\n\t    }\n\t  }\n\t}\n\t\n\t.bottom-section {\n\t  display: flex;\n\t  justify-content: space-between;\n\t  align-items: center;\n\t\n\t  .bottom-item {\n\t    flex: 1;\n\t    text-align: center;\n\t    display: flex;\n\t    flex-direction: column;\n\t    align-items: center;\n\t\n\t    .bottom-number {\n\t      font-size: 36rpx;\n\t      font-weight: bold;\n\t      color: #333;\n\t    }\n\t\n\t    .bottom-label {\n\t      font-size: 26rpx;\n\t      color: #888;\n\t      margin-top: 4rpx;\n\t    }\n\t  }\n\t\n\t  .vertical-line {\n\t    width: 2rpx;\n\t    height: 80rpx;\n\t    background-color: #eee;\n\t    margin: 0 20rpx;\n\t  }\n\t}\n.container {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n  /* 原有样式保持不变 */\n}\n\n/* 优化后的弹窗样式 */\n.setting-popup {\n  background-color: #fff;\n  border-radius: 20rpx 20rpx 0 0;\n  overflow: hidden;\n  box-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.1);\n  \n  .popup-header {\n    height: 88rpx;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: #f8f8f8;\n    \n    .popup-title {\n      font-size: 32rpx;\n      font-weight: 500;\n      color: #333;\n    }\n  }\n  \n  .popup-divider {\n    height: 2rpx;\n    background-color: #eee;\n  }\n  \n  .popup-item {\n    height: 96rpx;\n    display: flex;\n    align-items: center;\n    padding: 0 40rpx;\n    font-size: 34rpx;\n    color: #333;\n    \n    uni-icons {\n      margin-right: 24rpx;\n    }\n  }\n  \n  .popup-cancel {\n    height: 96rpx;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    margin-top: 16rpx;\n    background-color: #fff;\n    font-size: 34rpx;\n    color: #888;\n  }\n}\r\n// 登录按钮\r\n.username-button {\ndisplay: flex;                  /* 使用 Flex 布局 */\n  justify-content: flex-start;   /* 子元素（文字）靠左 */\n  align-items: center;           /* 垂直居中 */\n  text-align: left;              /* 多行文字左对齐 */\n  \n  font-size: 40rpx;\n  font-weight: bold;\n  margin-bottom: 8rpx;\n\n  background-color: transparent;\n  border: none;\n  padding: 0;\n\n  color: inherit;\n  line-height: 1;\n  width: 100%; /* 可选：让按钮撑满容器以更好控制布局 */\n}\n\n/* 去除按钮点击时微信小程序默认的边框样式 */\n.username-button::after {\n  border: none;\n}\n\n</style>    ","import MiniProgramPage from 'E:/project/uniapp/uniapp-news/pages/mymessage/mymessage.vue'\nwx.createPage(MiniProgramPage)"],"names":["useInfoStore","uni","ref","computed","onMounted","MiniProgramPage"],"mappings":";;;;;;;;;;;;;;AAwFA,MAAM,WAAW,MAAW;;;;AAI5B,UAAM,WAASA,WAAAA,aAAc;AAG7B,UAAM,aAAaC,cAAG,MAAC,kBAAmB;AAC1C,UAAM,WAAWC,cAAG,IAAC,IAAI;AACzB,UAAM,kBAAkBA,cAAAA,IAAI,WAAW,eAAe;AAKtD,UAAM,eAAeA,cAAG,IAAC,EAAE;AAG3B,UAAM,aAAaC,cAAQ,SAAC,OAAO;AAAA,MACjC,iBAAiB;AAAA,MACjB,UAAU,GAAG,aAAa,KAAK;AAAA;AAAA,MAC/B,WAAW;AAAA;AAAA,MACX,aAAa;AAAA;AAAA,MACb,UAAU;AAAA,MACV,oBAAoB;AAAA;AAAA,IACtB,EAAE;AAGF,UAAM,cAAcD,cAAG,IAAC,IAAI;AAE5BE,kBAAAA,UAAU,MAAI;AAAA,IAId,CAAC;AACD,UAAM,iBAAiB,OAAO,MAAM;AACnC,eAAS,gBAAiB;AACzB,UAAI,EAAE,OAAO,WAAW,qBAAqB;AAC5CH,sBAAAA,MAAY,MAAA,OAAA,wCAAA,CAAC;AACZA,sBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAC/C;AAAA,MACD;AAAA,IAGH;AAiBA,aAAS,gBAAgB;AACvBA,oBAAAA,MAAY,MAAA,OAAA,wCAAA,SAAS;AACrB,kBAAY,MAAM,MAAO;AAEzB,eAAS,eAAgB;AAAA,IAC3B;AAKA,aAAS,UAAU;AACjB,eAAS,MAAM,KAAM;AAAA,IACvB;AAGA,aAAS,aAAa;AACpB,eAAS,MAAM,MAAO;AAAA,IACxB;AAGA,aAAS,SAAS;AAChBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,cAAc;AAAA,QACd,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AAEf,qBAAS,WAAY;AAErB,uBAAY;AAEZA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,YAChB,CAAS;AAAA,UACF;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1LA,GAAG,WAAWI,SAAe;"}