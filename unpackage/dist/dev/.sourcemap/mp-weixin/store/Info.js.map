{"version":3,"file":"Info.js","sources":["store/Info.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { ref } from 'vue'\r\nimport { getinfologin,getinfoprofile } from '@/new-apis/info.js'\r\n\r\n\r\nexport const useInfoStore=defineStore('peopleinfo',()=>{\r\n\t// 个人信息\r\n\tlet info=ref({})\r\n\t// 标志位，判断是否登录\r\n\tconst signal=ref(false)\r\n\tconst getinfo=async()=>{\r\n\t\tsignal.value=true\r\n\t\tinfo.value={\r\n\t\t\tusername: '胡歌',\r\n\t\t\tslogan: '在阳光灿烂的日子里睡觉呀',\r\n\t\t\tnewsViews: 123,\r\n\t\t\tpolicyViews: 234,\r\n\t\t\tdaysOnline :128,\r\n\t\t\tfield : '人工智能',\r\n\t\t\tImage :'/static/picture.jpg'\r\n\t\t}\r\n\t\t\r\n\t}\r\n\tconst loginWithWeChat = async () => {\r\n\t  try {\r\n\t    // 1. 登录获取临时登录凭证 code\r\n\t    const loginRes = await uni.login();\r\n\t\r\n\t    if (loginRes.errMsg === \"login:ok\") {\r\n\t      const codes = loginRes.code;\r\n\t\t\tconsole.log(codes)\r\n\t      // 2. 发送 code 到你自己的后端\r\n\t      const res = await getinfologin({code:codes})\r\n\t\t  console.log(res)\r\n\t\t\tif(res.code===200){\r\n\t\t\t\tconsole.log(\"1111111111111111111111111111\")\r\n\t\t\t\tconsole.log(\"登录成功\")\r\n\t\t\t\t// getUserProfile(123)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t//       if (res.data.code === 200) {\r\n\t//         // 假设返回用户信息和你自己的token\r\n\t//         const userInfo = res.data.data;\r\n\t//         uni.setStorageSync('token', userInfo.token);\r\n\t//         uni.setStorageSync('userInfo', userInfo);\r\n\t\r\n\t//         uni.showToast({ title: '登录成功' });\r\n\t//       } else {\r\n\t//         uni.showToast({ title: '登录失败', icon: 'none' });\r\n\t//       }\r\n\t    }\r\n\t  } catch (err) {\r\n\t    console.error(\"登录失败\", err);\r\n\t  }\r\n\t};\r\n\tfunction deleteinfo(){\r\n\t\tsignal.value=false\r\n\t\tinfo.value={}\r\n\t}\r\n\t\r\n\tconst  getUserProfile =async(token)=>{\r\n\t  uni.getUserProfile({\r\n\t    desc: '用于完善用户资料',\r\n\t    success: (userRes) => {\r\n\t\t\tconsole.log(userRes)\r\n\t      const { encryptedData, iv } = userRes;\r\n\t\r\n\t      // 发送 encryptedData 和 iv 给后台，由后台用 session_key 解密\r\n\t      // uni.request({\r\n\t      //   url: 'http://你的服务器地址/api/user/decrypt',\r\n\t      //   method: 'POST',\r\n\t      //   data: {\r\n\t      //     encryptedData,\r\n\t      //     iv,\r\n\t      //     // token // 后台用 token 找到 session_key\r\n\t      //   },\r\n\t\t  // const res= await getinfoprofile({encryptedDatas:encryptedData,ivs:iv})\r\n\t      //   success: (decryptRes) => {\r\n\t      //     if (decryptRes.data.code === 200) {\r\n\t      //       console.log('用户信息：', decryptRes.data.data);\r\n\t      //       // 这里拿到用户昵称、头像等信息，可以保存到页面或者数据库\r\n\t      //     } else {\r\n\t      //       console.error('解密失败:', decryptRes.data.message);\r\n\t      //     }\r\n\t      //   }\r\n\t      // });\r\n\t    },\r\n\t    fail: (err) => {\r\n\t      console.error('用户拒绝授权:', err);\r\n\t    }\r\n\t  });\r\n\t}\r\n\r\n\t\r\n\t\r\n\treturn{\r\n\t\tinfo,\r\n\t\tsignal,\r\n\t\tgetinfo,\r\n\t\tdeleteinfo,\r\n\t\tloginWithWeChat,\r\n\t\tgetUserProfile\r\n\t}\r\n\t\r\n})\r\n"],"names":["defineStore","ref","uni","getinfologin"],"mappings":";;;AAKY,MAAC,eAAaA,cAAAA,YAAY,cAAa,MAAI;AAEtD,MAAI,OAAKC,cAAG,IAAC,EAAE;AAEf,QAAM,SAAOA,cAAG,IAAC,KAAK;AACtB,QAAM,UAAQ,YAAS;AACtB,WAAO,QAAM;AACb,SAAK,QAAM;AAAA,MACV,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,WAAW;AAAA,MACX,aAAa;AAAA,MACb,YAAY;AAAA,MACZ,OAAQ;AAAA,MACR,OAAO;AAAA,IACP;AAAA,EAED;AACD,QAAM,kBAAkB,YAAY;AAClC,QAAI;AAEF,YAAM,WAAW,MAAMC,oBAAI;AAE3B,UAAI,SAAS,WAAW,YAAY;AAClC,cAAM,QAAQ,SAAS;AAC3BA,sBAAAA,MAAY,MAAA,OAAA,uBAAA,KAAK;AAEb,cAAM,MAAM,MAAMC,aAAAA,aAAa,EAAC,MAAK,MAAK,CAAC;AAC9CD,sBAAAA,MAAA,MAAA,OAAA,uBAAY,GAAG;AAChB,YAAG,IAAI,SAAO,KAAI;AACjBA,wBAAAA,MAAA,MAAA,OAAA,uBAAY,8BAA8B;AAC1CA,wBAAAA,MAAY,MAAA,OAAA,uBAAA,MAAM;AAAA,QAElB;AAAA,MAaE;AAAA,IACF,SAAQ,KAAK;AACZA,oBAAc,MAAA,MAAA,SAAA,uBAAA,QAAQ,GAAG;AAAA,IAC1B;AAAA,EACJ;AACC,WAAS,aAAY;AACpB,WAAO,QAAM;AACb,SAAK,QAAM,CAAE;AAAA,EACb;AAED,QAAO,iBAAgB,OAAM,UAAQ;AACnCA,kBAAAA,MAAI,eAAe;AAAA,MACjB,MAAM;AAAA,MACN,SAAS,CAAC,YAAY;AACxBA,sBAAAA,MAAA,MAAA,OAAA,uBAAY,OAAO;AAAA,MAsBhB;AAAA,MACD,MAAM,CAAC,QAAQ;AACbA,sBAAA,MAAA,MAAA,SAAA,uBAAc,WAAW,GAAG;AAAA,MAC7B;AAAA,IACN,CAAI;AAAA,EACF;AAID,SAAM;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACA;AAEF,CAAC;;"}