{"version":3,"file":"Info.js","sources":["store/Info.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { ref } from 'vue'\nimport { getinfologin,getinfoprofile } from '@/new-apis/info.js'\n\n\nexport const useInfoStore=defineStore('peopleinfo',()=>{\n\t// 个人信息\n\tlet info=ref({})\n\t\n\tconst token =ref(\"\")\n\t// 标志位，判断是否登录\n\tconst signal=ref(true)\n\tconst getinfo=async()=>{\n\t\tsignal.value=true\n\t\tinfo.value={\n\t\t\tusername: '胡歌',\n\t\t\tslogan: '在阳光灿烂的日子里睡觉呀',\n\t\t\tnewsViews: 123,\n\t\t\tpolicyViews: 234,\n\t\t\tdaysOnline :128,\n\t\t\tfield : '人工智能',\n\t\t\tImage :'/static/picture.jpg'\n\t\t}\n\t\t\n\t}\n\tconst loginWithWeChat = async () => {\n\t  try {\n\t    // 1. 登录获取临时登录凭证 code\n\t    const loginRes = await uni.login({provider: 'weixin'});\n\t\n\t    if (loginRes.errMsg === \"login:ok\") {\n\t      const codes = loginRes.code;\n\t\t\tconsole.log(codes)\n\t      // 2. 发送 code 到你自己的后端\n\t      const res = await getinfologin({code:codes})\n\t\t  token.value=res.token\n\t\t  console.log(token.value)\n\t\t\tif(res.code===200){\n\t\t\t\tconsole.log(\"1111111111111111111111111111\")\n\t\t\t\tconsole.log(\"登录成功\")\n\t\t\t}\n\t\t\t\n\t\t\t\n\t//       if (res.data.code === 200) {\n\t//         // 假设返回用户信息和你自己的token\n\t//         const userInfo = res.data.data;\n\t//         uni.setStorageSync('token', userInfo.token);\n\t//         uni.setStorageSync('userInfo', userInfo);\n\t\n\t//         uni.showToast({ title: '登录成功' });\n\t//       } else {\n\t//         uni.showToast({ title: '登录失败', icon: 'none' });\n\t//       }\n\t    }\n\t  } catch (err) {\n\t    console.error(\"登录失败\", err);\n\t  }\n\t};\n\tfunction deleteinfo(){\n\t\tsignal.value=false\n\t\tinfo.value={}\n\t}\n\t\n\tconst getUserProfile = async () => {\n\t  uni.getUserProfile({\n\t    desc: '用于完善用户资料',\n\t    \n\t    success: async (userRes) => {\n\t      console.log(userRes);\n\t      const { encryptedData, iv } = userRes;\n\t\t  console.log(encryptedData)\n\t\n\t      try {\n\t        \n\t        const res = await getinfoprofile({ encryptedData: encryptedData, iv: iv ,token:token.value});\n\t        console.log(res); // 处理你的请求结果\n\t      } catch (error) {\n\t        console.error('请求出错:', error);\n\t      }\n\t    },\n\t    fail: (err) => {\n\t      console.error('用户拒绝授权:', err);\n\t    },\n\t  });\n\t};\n\n\t\n\t\n\treturn{\n\t\tinfo,\n\t\tsignal,\n\t\tgetinfo,\n\t\tdeleteinfo,\n\t\tloginWithWeChat,\n\t\tgetUserProfile\n\t}\n\t\n})"],"names":["defineStore","ref","uni","getinfologin","getinfoprofile"],"mappings":";;;AAKY,MAAC,eAAaA,cAAAA,YAAY,cAAa,MAAI;AAEtD,MAAI,OAAKC,cAAG,IAAC,EAAE;AAEf,QAAM,QAAOA,cAAG,IAAC,EAAE;AAEnB,QAAM,SAAOA,cAAG,IAAC,IAAI;AACrB,QAAM,UAAQ,YAAS;AACtB,WAAO,QAAM;AACb,SAAK,QAAM;AAAA,MACV,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,WAAW;AAAA,MACX,aAAa;AAAA,MACb,YAAY;AAAA,MACZ,OAAQ;AAAA,MACR,OAAO;AAAA,IACP;AAAA,EAED;AACD,QAAM,kBAAkB,YAAY;AAClC,QAAI;AAEF,YAAM,WAAW,MAAMC,oBAAI,MAAM,EAAC,UAAU,SAAQ,CAAC;AAErD,UAAI,SAAS,WAAW,YAAY;AAClC,cAAM,QAAQ,SAAS;AAC3BA,sBAAAA,MAAY,MAAA,OAAA,uBAAA,KAAK;AAEb,cAAM,MAAM,MAAMC,aAAAA,aAAa,EAAC,MAAK,MAAK,CAAC;AAC9C,cAAM,QAAM,IAAI;AAChBD,sBAAAA,MAAA,MAAA,OAAA,uBAAY,MAAM,KAAK;AACxB,YAAG,IAAI,SAAO,KAAI;AACjBA,wBAAAA,MAAA,MAAA,OAAA,uBAAY,8BAA8B;AAC1CA,wBAAAA,MAAY,MAAA,OAAA,uBAAA,MAAM;AAAA,QAClB;AAAA,MAaE;AAAA,IACF,SAAQ,KAAK;AACZA,oBAAA,MAAA,MAAA,SAAA,uBAAc,QAAQ,GAAG;AAAA,IAC1B;AAAA,EACJ;AACC,WAAS,aAAY;AACpB,WAAO,QAAM;AACb,SAAK,QAAM,CAAE;AAAA,EACb;AAED,QAAM,iBAAiB,YAAY;AACjCA,kBAAAA,MAAI,eAAe;AAAA,MACjB,MAAM;AAAA,MAEN,SAAS,OAAO,YAAY;AAC1BA,sBAAAA,MAAA,MAAA,OAAA,uBAAY,OAAO;AACnB,cAAM,EAAE,eAAe,GAAI,IAAG;AACjCA,sBAAAA,MAAY,MAAA,OAAA,uBAAA,aAAa;AAEtB,YAAI;AAEF,gBAAM,MAAM,MAAME,4BAAe,EAAE,eAA8B,IAAQ,OAAM,MAAM,MAAK,CAAC;AAC3FF,wBAAAA,MAAY,MAAA,OAAA,uBAAA,GAAG;AAAA,QAChB,SAAQ,OAAO;AACdA,wBAAc,MAAA,MAAA,SAAA,uBAAA,SAAS,KAAK;AAAA,QAC7B;AAAA,MACF;AAAA,MACD,MAAM,CAAC,QAAQ;AACbA,sBAAA,MAAA,MAAA,SAAA,uBAAc,WAAW,GAAG;AAAA,MAC7B;AAAA,IACN,CAAI;AAAA,EACJ;AAIC,SAAM;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACA;AAEF,CAAC;;"}