{"version":3,"file":"MessageCard.js","sources":["components/MessageCard/MessageCard.vue","D:/Hbuild/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTovcHJvamVjdC91bmlhcHAvdW5pYXBwLW5ld3MvY29tcG9uZW50cy9NZXNzYWdlQ2FyZC9NZXNzYWdlQ2FyZC52dWU"],"sourcesContent":["<template>\n  <view \n    class=\"message-card\" \n    :class=\"{ \n      'has-unread': hasUnreadMessages,\n      'loading': loading,\n      'system-message': messageType === 'system',\n      'group-message': messageType === 'group'\n    }\"\n    @tap=\"handleCardTap\"\n  >\n    <!-- 卡片背景装饰 -->\n    <view class=\"card-decoration\"></view>\n    \n    <!-- 主要内容区 -->\n    <view class=\"card-body\">\n      <!-- 顶部信息行 -->\n      <view class=\"top-section\">\n        <!-- 左侧：头像和标题 -->\n        <view class=\"info-section\">\n          <view class=\"avatar\" :style=\"getAvatarStyle()\">\n            <text v-if=\"messageType === 'system'\" class=\"avatar-icon\">🔔</text>\n            <text v-else class=\"avatar-text\">{{ getAvatarText() }}</text>\n          </view>\n          <view class=\"title-section\">\n            <text class=\"title\">{{ message.group_name || getDefaultGroupName() }}</text>\n            <view class=\"meta-info\">\n              <text class=\"type-tag\">{{ messageType === 'system' ? '系统' : '群聊' }}</text>\n              <text class=\"timestamp\">{{ formattedTime }}</text>\n            </view>\n          </view>\n        </view>\n        \n        <!-- 右侧：状态指示器 -->\n        <view class=\"status-section\">\n          <view v-if=\"hasUnreadMessages\" class=\"unread-indicator\">\n            <text class=\"unread-count\">{{ displayUnreadCount }}</text>\n          </view>\n          <view class=\"arrow-icon\">\n            <text class=\"arrow\">→</text>\n          </view>\n        </view>\n      </view>\n      \n      <!-- 消息内容区 -->\n      <view class=\"content-section\">\n        <text class=\"message-preview\">{{ displayContent }}</text>\n      </view>\n    </view>\n    \n    <!-- 未读消息强调条 -->\n    <view v-if=\"hasUnreadMessages\" class=\"unread-accent\"></view>\n  </view>\n</template>\n\n<script setup>\nimport { computed, ref } from 'vue'\n\n// Props定义\nconst props = defineProps({\n  message: {\n    type: Object,\n    required: true,\n    default: () => ({\n      id: '',\n      group_name: '',\n      unread_count: 0,\n      is_read: 1,\n      latest_content: '',\n      latest_time: '',\n      type: 'group'\n    })\n  },\n  messageType: {\n    type: String,\n    default: 'group',\n    validator: (value) => ['system', 'group'].includes(value)\n  },\n  loading: {\n    type: Boolean,\n    default: false\n  }\n})\n\n// Emits定义\nconst emit = defineEmits(['tap', 'markAsRead'])\n\n// 计算属性\nconst hasUnreadMessages = computed(() => {\n  return props.message.unread_count > 0 || props.message.is_read === 0\n})\n\nconst displayUnreadCount = computed(() => {\n  const count = props.message.unread_count || (props.message.is_read === 0 ? 1 : 0)\n  return count > 99 ? '99+' : count.toString()\n})\n\nconst displayContent = computed(() => {\n  const content = props.message.latest_content || props.message.content || props.message.message || ''\n  return content || (props.messageType === 'system' ? '系统通知消息' : '暂无消息内容')\n})\n\nconst formattedTime = computed(() => {\n  return formatTime(props.message.latest_time || props.message.created_at || props.message.updated_at)\n})\n\n// 获取默认群组名\nconst getDefaultGroupName = () => {\n  return props.messageType === 'system' ? '系统通知' : '未知群组'\n}\n\n// 获取头像文字\nconst getAvatarText = () => {\n  const name = props.message.group_name || '未知'\n  const firstChar = name.charAt(0)\n  return firstChar.toUpperCase()\n}\n\n// 获取头像样式\nconst getAvatarStyle = () => {\n  if (props.messageType === 'system') {\n    return {\n      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n      color: '#ffffff'\n    }\n  }\n  \n  const name = props.message.group_name || 'default'\n  let hash = 0\n  for (let i = 0; i < name.length; i++) {\n    hash = name.charCodeAt(i) + ((hash << 5) - hash)\n  }\n  \n  const gradients = [\n    'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n    'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',\n    'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',\n    'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',\n    'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',\n    'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',\n    'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)',\n    'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)'\n  ]\n  \n  const colorIndex = Math.abs(hash) % gradients.length\n  return {\n    background: gradients[colorIndex],\n    color: '#ffffff'\n  }\n}\n\n// 处理卡片点击\nconst handleCardTap = () => {\n  if (props.loading) return\n  \n  emit('tap', props.message, props.messageType)\n  \n  if (hasUnreadMessages.value) {\n    emit('markAsRead', props.message, props.messageType)\n  }\n}\n\n// 时间格式化\nconst formatTime = (time) => {\n  if (!time) return ''\n  \n  try {\n    const now = new Date()\n    let msgTime\n    \n    if (typeof time === 'string') {\n      msgTime = new Date(time)\n    } else if (time instanceof Date) {\n      msgTime = time\n    } else if (typeof time === 'number') {\n      msgTime = new Date(time)\n    } else {\n      return String(time)\n    }\n    \n    if (isNaN(msgTime.getTime())) {\n      console.warn('无效的日期格式:', time)\n      return String(time)\n    }\n    \n    const diff = now - msgTime\n    const minutes = Math.floor(diff / (1000 * 60))\n    const hours = Math.floor(diff / (1000 * 60 * 60))\n    const days = Math.floor(diff / (1000 * 60 * 60 * 24))\n    \n    if (minutes < 1) {\n      return '刚刚'\n    } else if (minutes < 60) {\n      return `${minutes}分钟前`\n    } else if (hours < 24) {\n      return `${hours}小时前`\n    } else if (days === 1) {\n      return '昨天'\n    } else if (days <= 7) {\n      return `${days}天前`\n    } else {\n      const month = msgTime.getMonth() + 1\n      const date = msgTime.getDate()\n      \n      if (msgTime.getFullYear() === now.getFullYear()) {\n        return `${month}月${date}日`\n      } else {\n        return `${msgTime.getFullYear()}年${month}月${date}日`\n      }\n    }\n  } catch (error) {\n    console.error('时间格式化错误:', error, '原始时间:', time)\n    return String(time)\n  }\n}\n</script>\n\n<style scoped>\n/* 主卡片容器 */\n.message-card {\n  position: relative;\n  background: #ffffff;\n  border-radius: 24rpx;\n  margin: 0 0 24rpx 0;\n  overflow: hidden;\n  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n  box-shadow: \n    0 4rpx 20rpx rgba(0, 0, 0, 0.04),\n    0 1rpx 3rpx rgba(0, 0, 0, 0.08);\n}\n\n.message-card:active {\n  transform: translateY(-4rpx) scale(0.996);\n  box-shadow: \n    0 12rpx 40rpx rgba(0, 0, 0, 0.08),\n    0 4rpx 8rpx rgba(0, 0, 0, 0.12);\n}\n\n/* 背景装饰 */\n.card-decoration {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 120rpx;\n  height: 120rpx;\n  background: radial-gradient(circle, rgba(0, 123, 255, 0.05) 0%, transparent 70%);\n  border-radius: 50%;\n  transform: translate(40rpx, -40rpx);\n}\n\n.system-message .card-decoration {\n  background: radial-gradient(circle, rgba(255, 107, 107, 0.08) 0%, transparent 70%);\n}\n\n/* 未读消息装饰 */\n.has-unread .card-decoration {\n  background: radial-gradient(circle, rgba(255, 107, 107, 0.12) 0%, transparent 70%);\n  animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n  0%, 100% { opacity: 1; }\n  50% { opacity: 0.7; }\n}\n\n/* 卡片主体 */\n.card-body {\n  padding: 32rpx 28rpx;\n  position: relative;\n  z-index: 2;\n}\n\n/* 顶部信息区 */\n.top-section {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 24rpx;\n}\n\n.info-section {\n  display: flex;\n  align-items: flex-start;\n  gap: 24rpx;\n  flex: 1;\n  min-width: 0;\n}\n\n/* 头像样式 */\n.avatar {\n  width: 80rpx;\n  height: 80rpx;\n  border-radius: 20rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.12);\n  border: 3rpx solid rgba(255, 255, 255, 0.9);\n}\n\n.avatar-text {\n  font-size: 32rpx;\n  color: inherit;\n  font-weight: 700;\n}\n\n.avatar-icon {\n  font-size: 32rpx;\n}\n\n/* 标题区域 */\n.title-section {\n  flex: 1;\n  min-width: 0;\n}\n\n.title {\n  font-size: 36rpx;\n  font-weight: 700;\n  color: #1a202c;\n  line-height: 1.3;\n  margin-bottom: 8rpx;\n  display: block;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  letter-spacing: -0.5rpx;\n}\n\n.system-message .title {\n  color: #2d3748;\n}\n\n.has-unread .title {\n  color: #2b6cb0;\n}\n\n.system-message.has-unread .title {\n  color: #c53030;\n}\n\n/* 元信息 */\n.meta-info {\n  display: flex;\n  align-items: center;\n  gap: 16rpx;\n}\n\n.type-tag {\n  font-size: 22rpx;\n  font-weight: 600;\n  color: #718096;\n  background: #f7fafc;\n  padding: 8rpx 16rpx;\n  border-radius: 20rpx;\n  border: 1rpx solid #e2e8f0;\n}\n\n.system-message .type-tag {\n  background: #fed7d7;\n  color: #c53030;\n  border-color: #feb2b2;\n}\n\n.group-message .type-tag {\n  background: #bee3f8;\n  color: #2b6cb0;\n  border-color: #90cdf4;\n}\n\n.timestamp {\n  font-size: 24rpx;\n  color: #a0aec0;\n  font-weight: 500;\n}\n\n.has-unread .timestamp {\n  color: #4299e1;\n  font-weight: 600;\n}\n\n/* 状态区域 */\n.status-section {\n  display: flex;\n  align-items: center;\n  gap: 16rpx;\n  flex-shrink: 0;\n}\n\n/* 未读指示器 */\n.unread-indicator {\n  position: relative;\n}\n\n.unread-count {\n  background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);\n  color: #ffffff;\n  font-size: 22rpx;\n  font-weight: 800;\n  padding: 8rpx 16rpx;\n  border-radius: 24rpx;\n  min-width: 32rpx;\n  height: 32rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: \n    0 4rpx 12rpx rgba(66, 153, 225, 0.4),\n    0 2rpx 4rpx rgba(66, 153, 225, 0.3);\n  animation: bounce 0.6s ease-in-out;\n}\n\n.system-message .unread-count {\n  background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);\n  box-shadow: \n    0 4rpx 12rpx rgba(245, 101, 101, 0.4),\n    0 2rpx 4rpx rgba(245, 101, 101, 0.3);\n}\n\n@keyframes bounce {\n  0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }\n  40%, 43% { transform: translate3d(0,-8rpx,0); }\n  70% { transform: translate3d(0,-4rpx,0); }\n}\n\n/* 箭头图标 */\n.arrow-icon {\n  padding: 12rpx;\n  border-radius: 50%;\n  background: rgba(113, 128, 150, 0.1);\n  transition: all 0.3s ease;\n}\n\n.arrow {\n  font-size: 28rpx;\n  color: #718096;\n  font-weight: 300;\n}\n\n.has-unread .arrow-icon {\n  background: rgba(66, 153, 225, 0.15);\n}\n\n.has-unread .arrow {\n  color: #4299e1;\n}\n\n.system-message.has-unread .arrow-icon {\n  background: rgba(245, 101, 101, 0.15);\n}\n\n.system-message.has-unread .arrow {\n  color: #f56565;\n}\n\n.message-card:active .arrow {\n  transform: translateX(4rpx);\n}\n\n/* 内容区域 */\n.content-section {\n  padding-left: 104rpx;\n}\n\n.message-preview {\n  font-size: 30rpx;\n  color: #4a5568;\n  line-height: 1.6;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  word-break: break-word;\n  font-weight: 400;\n  letter-spacing: 0.5rpx;\n}\n\n.system-message .message-preview {\n  color: #2d3748;\n}\n\n.has-unread .message-preview {\n  color: #2d3748;\n  font-weight: 500;\n}\n\n/* 未读强调条 */\n.unread-accent {\n  position: absolute;\n  left: 0;\n  top: 50%;\n  transform: translateY(-50%);\n  width: 8rpx;\n  height: 60rpx;\n  background: linear-gradient(to bottom, #4299e1, #3182ce);\n  border-radius: 0 8rpx 8rpx 0;\n  box-shadow: 2rpx 0 8rpx rgba(66, 153, 225, 0.3);\n}\n\n.system-message .unread-accent {\n  background: linear-gradient(to bottom, #f56565, #e53e3e);\n  box-shadow: 2rpx 0 8rpx rgba(245, 101, 101, 0.3);\n}\n\n/* 加载状态 */\n.message-card.loading {\n  opacity: 0.6;\n  pointer-events: none;\n  position: relative;\n}\n\n.message-card.loading::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, \n    transparent, \n    rgba(255, 255, 255, 0.6), \n    transparent\n  );\n  animation: shimmer 2s infinite;\n  z-index: 10;\n}\n\n@keyframes shimmer {\n  0% { left: -100%; }\n  100% { left: 100%; }\n}\n\n/* 特殊卡片样式 */\n.has-unread {\n  background: linear-gradient(135deg, #ffffff 0%, #f7fafc 100%);\n  border: 1rpx solid rgba(66, 153, 225, 0.1);\n}\n\n.system-message.has-unread {\n  background: linear-gradient(135deg, #ffffff 0%, #fffafa 100%);\n  border: 1rpx solid rgba(245, 101, 101, 0.1);\n}\n\n/* 深色模式适配 */\n@media (prefers-color-scheme: dark) {\n  .message-card {\n    background: #2d3748;\n    box-shadow: \n      0 4rpx 20rpx rgba(0, 0, 0, 0.2),\n      0 1rpx 3rpx rgba(0, 0, 0, 0.3);\n  }\n  \n  .title {\n    color: #f7fafc;\n  }\n  \n  .system-message .title {\n    color: #fed7d7;\n  }\n  \n  .has-unread .title {\n    color: #90cdf4;\n  }\n  \n  .system-message.has-unread .title {\n    color: #feb2b2;\n  }\n  \n  .type-tag {\n    background: #4a5568;\n    color: #cbd5e0;\n    border-color: #718096;\n  }\n  \n  .message-preview {\n    color: #cbd5e0;\n  }\n  \n  .timestamp {\n    color: #718096;\n  }\n  \n  .arrow {\n    color: #a0aec0;\n  }\n  \n  .has-unread {\n    background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);\n    border-color: rgba(66, 153, 225, 0.2);\n  }\n  \n  .system-message.has-unread {\n    background: linear-gradient(135deg, #2d3748 0%, #2c1810 100%);\n    border-color: rgba(245, 101, 101, 0.2);\n  }\n}\n</style>","import Component from 'E:/project/uniapp/uniapp-news/components/MessageCard/MessageCard.vue'\nwx.createComponent(Component)"],"names":["computed","uni"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2DA,UAAM,QAAQ;AA0Bd,UAAM,OAAO;AAGb,UAAM,oBAAoBA,cAAQ,SAAC,MAAM;AACvC,aAAO,MAAM,QAAQ,eAAe,KAAK,MAAM,QAAQ,YAAY;AAAA,IACrE,CAAC;AAED,UAAM,qBAAqBA,cAAQ,SAAC,MAAM;AACxC,YAAM,QAAQ,MAAM,QAAQ,iBAAiB,MAAM,QAAQ,YAAY,IAAI,IAAI;AAC/E,aAAO,QAAQ,KAAK,QAAQ,MAAM,SAAU;AAAA,IAC9C,CAAC;AAED,UAAM,iBAAiBA,cAAQ,SAAC,MAAM;AACpC,YAAM,UAAU,MAAM,QAAQ,kBAAkB,MAAM,QAAQ,WAAW,MAAM,QAAQ,WAAW;AAClG,aAAO,YAAY,MAAM,gBAAgB,WAAW,WAAW;AAAA,IACjE,CAAC;AAED,UAAM,gBAAgBA,cAAQ,SAAC,MAAM;AACnC,aAAO,WAAW,MAAM,QAAQ,eAAe,MAAM,QAAQ,cAAc,MAAM,QAAQ,UAAU;AAAA,IACrG,CAAC;AAGD,UAAM,sBAAsB,MAAM;AAChC,aAAO,MAAM,gBAAgB,WAAW,SAAS;AAAA,IACnD;AAGA,UAAM,gBAAgB,MAAM;AAC1B,YAAM,OAAO,MAAM,QAAQ,cAAc;AACzC,YAAM,YAAY,KAAK,OAAO,CAAC;AAC/B,aAAO,UAAU,YAAa;AAAA,IAChC;AAGA,UAAM,iBAAiB,MAAM;AAC3B,UAAI,MAAM,gBAAgB,UAAU;AAClC,eAAO;AAAA,UACL,YAAY;AAAA,UACZ,OAAO;AAAA,QACR;AAAA,MACF;AAED,YAAM,OAAO,MAAM,QAAQ,cAAc;AACzC,UAAI,OAAO;AACX,eAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACpC,eAAO,KAAK,WAAW,CAAC,MAAM,QAAQ,KAAK;AAAA,MAC5C;AAED,YAAM,YAAY;AAAA,QAChB;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACD;AAED,YAAM,aAAa,KAAK,IAAI,IAAI,IAAI,UAAU;AAC9C,aAAO;AAAA,QACL,YAAY,UAAU,UAAU;AAAA,QAChC,OAAO;AAAA,MACR;AAAA,IACH;AAGA,UAAM,gBAAgB,MAAM;AAC1B,UAAI,MAAM;AAAS;AAEnB,WAAK,OAAO,MAAM,SAAS,MAAM,WAAW;AAE5C,UAAI,kBAAkB,OAAO;AAC3B,aAAK,cAAc,MAAM,SAAS,MAAM,WAAW;AAAA,MACpD;AAAA,IACH;AAGA,UAAM,aAAa,CAAC,SAAS;AAC3B,UAAI,CAAC;AAAM,eAAO;AAElB,UAAI;AACF,cAAM,MAAM,oBAAI,KAAM;AACtB,YAAI;AAEJ,YAAI,OAAO,SAAS,UAAU;AAC5B,oBAAU,IAAI,KAAK,IAAI;AAAA,QAC7B,WAAe,gBAAgB,MAAM;AAC/B,oBAAU;AAAA,QAChB,WAAe,OAAO,SAAS,UAAU;AACnC,oBAAU,IAAI,KAAK,IAAI;AAAA,QAC7B,OAAW;AACL,iBAAO,OAAO,IAAI;AAAA,QACnB;AAED,YAAI,MAAM,QAAQ,QAAO,CAAE,GAAG;AAC5BC,wBAAAA,MAAa,MAAA,QAAA,iDAAA,YAAY,IAAI;AAC7B,iBAAO,OAAO,IAAI;AAAA,QACnB;AAED,cAAM,OAAO,MAAM;AACnB,cAAM,UAAU,KAAK,MAAM,QAAQ,MAAO,GAAG;AAC7C,cAAM,QAAQ,KAAK,MAAM,QAAQ,MAAO,KAAK,GAAG;AAChD,cAAM,OAAO,KAAK,MAAM,QAAQ,MAAO,KAAK,KAAK,GAAG;AAEpD,YAAI,UAAU,GAAG;AACf,iBAAO;AAAA,QACb,WAAe,UAAU,IAAI;AACvB,iBAAO,GAAG,OAAO;AAAA,QACvB,WAAe,QAAQ,IAAI;AACrB,iBAAO,GAAG,KAAK;AAAA,QACrB,WAAe,SAAS,GAAG;AACrB,iBAAO;AAAA,QACb,WAAe,QAAQ,GAAG;AACpB,iBAAO,GAAG,IAAI;AAAA,QACpB,OAAW;AACL,gBAAM,QAAQ,QAAQ,SAAQ,IAAK;AACnC,gBAAM,OAAO,QAAQ,QAAS;AAE9B,cAAI,QAAQ,YAAW,MAAO,IAAI,YAAW,GAAI;AAC/C,mBAAO,GAAG,KAAK,IAAI,IAAI;AAAA,UAC/B,OAAa;AACL,mBAAO,GAAG,QAAQ,YAAa,CAAA,IAAI,KAAK,IAAI,IAAI;AAAA,UACjD;AAAA,QACF;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAc,MAAA,MAAA,SAAA,iDAAA,YAAY,OAAO,SAAS,IAAI;AAC9C,eAAO,OAAO,IAAI;AAAA,MACnB;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrNA,GAAG,gBAAgB,SAAS;"}